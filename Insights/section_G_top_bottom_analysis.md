## <div align = "center"> Section G â€” Top n Bottom Analysis </div>

### Objective

This section focuses on uncovering key business insights using advanced SQL techniques such as ranking, aggregation, and time-bas analysis. The goal is to identify top-performing customers, lowest-selling products, consistent buyers, and purchasing patterns to evaluate business performance and customer engagement
##

<b> Q25. Identify the top 3 performing customers based on total purchases. </b>                                                   
### <i> Explanation </i> 
This question aims to identify the top-performing customers based on total spending. To solve it, 
I used a subquery in the FROM clause to first calculate the total amount spent by each customer and assign a rank based on the sum in descending order. 
Then, in the outer query, I filtered for ranking <= 3 to retrieve only the top three customers.

### <i> Query: </i>

    -- Main Query
    
    SELECT 
    		*
    FROM
    	(-- subquery to get rank the customers
    	SELECT 
    			user_id,
    			SUM(total_amount) AS total_purchase,
    			RANK() OVER(ORDER BY SUM(total_amount) DESC) AS ranking
    	FROM orders
    	GROUP BY user_id) AS r
    WHERE r.ranking <=3;

### <i> Insight | Recommendation: </i>
1. customers with ID - 6, 1, 3 were the top perfroming customers.
2. These top 3 customers represent a substantial portion of total sales. They contributed 56% of the total revenue generated by the mart.
3. We can consider offering incentives or exclusive deals to these top customers to retain them.
### <i> Result: </i>
<img width="992" height="506" alt="image" src="https://github.com/user-attachments/assets/2dcf7588-0eff-47ec-870b-181ea99dbef6" /> <br>   

<b> Q26. Identify the lowest-selling product category. </b>                                                   
### <i> Explanation </i> 
To identify the product category with lowest sales, I solved it from the quantity and revenue perspective. This helps provides a broader view of both financial performance and product demand. Below is the code explaining how I solved it 

### <i> Query 1: In terms of REVENUE </i>
This query joins the Products and Orders tables on product_id to access both the total_amount and category columns.
The total sales amount per category is calculated using SUM(o.total_amount) and ranked using the RANK() window function.
Finally, the main query filters the result to only show the category ranked 1, which represents the lowest-selling category by revenue.

    -- Main Query
    SELECT 
        category,
        total_purchase
    FROM 
            (-- Subquery 
            SELECT 
            		SUM(o.total_amount) AS total_purchase,
                    category,
                    RANK() OVER(ORDER BY SUM(o.total_amount)) as ranking
            FROM orders AS o
            INNER JOIN products AS p
            ON o.product_id = p.product_id
            GROUP BY p.category
            ) AS s
    WHERE ranking = 1;

   ### <i> Query 2: In terms of QUANTITY </i> 
This query follows a similar logic but uses quantity sold as the measure instead of revenue.
It sums up quantity per category and sorts the result in ascending order to find the category with the lowest total units sold, reflecting customer demand or popularity rather than profit.

    SELECT 
            category,
            SUM(quantity) AS total_quantity_sold
    FROM products AS p
    LEFT JOIN orders AS o
    ON p.product_id = o.product_id
    GROUP BY category
    ORDER BY SUM(quantity)
    LIMIT 1;

### <i> Insight | Recommendation: </i>
1. From the analysis carried out using both quantity sold and revenue generated, the Dairy product category emerged as the lowest-selling category, accounting for approximately 7.7% of total quantity sold and 14.5% of total revenue. This indicates that while Dairy products contribute a small share to overall sales, their underperformance is unusual given that they are typically high-demand items.
2. A feedback system should be implemented to understand why customers are not purchasing Dairy products as expected.                    
3. Additionally, tracking customer satisfaction specifically for Dairy products could help uncover potential issues related to pricing, product quality, or availability.                                                                                                       
### <i> Result: </i> 
Method 1-
<img width="1003" height="427" alt="image" src="https://github.com/user-attachments/assets/6be46c5e-d926-41d8-b96f-cc01ccbc6d86" />
Method 2-
<img width="1109" height="334" alt="image" src="https://github.com/user-attachments/assets/c4aef619-7712-4415-8b74-1d5da4de61a8" />

<b> Q27. Find customers who made a purchase every month in 2024. </b>                                                   
### <i> Explanation </i> 
TO obtain customers who made purchase for each month consecutively in 2024, I had to first filter the YEAR(order_date) = 2024. This nsure that the data I am working with is only in 2024 after then in my SELECT clause, I obtained the distinct month for each customer's orders. Once this was done, I embeded it as a subquery in the FROM clause. In the main query, I selected the user_id, did a count of each row in the table nut for each individual user then filtered using the HAVIONG function for customers having count(*) = 12. THis ensures that only thise who bought for the 12 months in 2024 are seected. below is the code 

### <i> Query 1:</i>

    SELECT 
    	user_id,
        COUNT(*) AS orders_customers
    FROM
    	(
    	SELECT 
    			DISTINCT(MONTH(order_date)) AS `month`,
                user_id
    	FROM orders
    	WHERE YEAR(order_date) = 2024
        ORDER BY user_id) AS s
    GROUP BY user_id
    HAVING COUNT(*) = 12 ;

### <i> Insight | Recommendation: </i>
1. From the analysis, no customer bought consecutively for the 12 months in 2024.
2. Introduction of a customer retention program or loyalty incentives will encourage monthly repeat purchases.
3. Track purchase frequency metrics such as Customer Retention Rate (CRR) to monitor progress over time.                               
### <i> Result: </i> 
<img width="1116" height="452" alt="image" src="https://github.com/user-attachments/assets/93d17efb-037c-451a-a8cd-c6c5f943e5ab" />


<b> Q28. Calculate the average time between consecutive orders for each customer (advanced LAG challenge). </b>     




















